"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[51],{2418:(e,t,r)=>{r.d(t,{M:()=>i,u:()=>n});let c={},a={},n=e=>{e&&(c=e.characters||{},a=e.gameInfo||{})},o={me:"#dfcb93",default:"#333"},i=e=>{let t=c[e];return"narrator"===e?{displayName:" ",speakerColor:" "}:"me"===e?{displayName:(null==t?void 0:t.name)||a.me||"나",speakerColor:(null==t?void 0:t.color)||o.me}:"???"===e?{displayName:(null==t?void 0:t.name)||"???",speakerColor:(null==t?void 0:t.color)||o.me}:{displayName:(null==t?void 0:t.name)||e,speakerColor:(null==t?void 0:t.color)||o.default}}},3550:(e,t,r)=>{r.d(t,{Ol:()=>o,nC:()=>i,uk:()=>a,x2:()=>n});let c={},a=e=>{e&&e.characters&&(c=e.characters)};function n(e,t){var r,a;let n=c[e],o=null!=(r=null==n?void 0:n.minAffection)?r:-10;return Math.min(null!=(a=null==n?void 0:n.maxAffection)?a:10,Math.max(o,t))}function o(){let e={};return Object.values(c).forEach(t=>{var r;let c=null!=(r=t.initialAffection)?r:0;e[t.id]=n(t.id,c)}),e}function i(e,t){var r,a;let n=c[e],o=null!=(r=null==n?void 0:n.minAffection)?r:-10,i=null!=(a=null==n?void 0:n.maxAffection)?a:10,s=Math.min(i,Math.max(o,t));return"".concat(Math.round((s-o)/(i-o||1)*100),"%")}},4197:(e,t,r)=>{r.d(t,{U:()=>n,u:()=>a});let c={},a=e=>{e&&e.places&&(c=e.places)},n=e=>{if(!e)return{background:"#f5f5f5"};let t=c[e];if(!t)return{background:"#f5f5f5"};if(t.image)try{let e="/assets/places/".concat(t.image);return{backgroundImage:"url(".concat(e,")"),backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}}catch(t){console.error("Failed to load background image for ".concat(e,":"),t)}return{background:t.color||"#f5f5f5"}}},4305:(e,t,r)=>{r.d(t,{h0:()=>g,uK:()=>m,uk:()=>o,vi:()=>p});let c={},a={},n=[],o=e=>{e&&(c=e.characters||{},a=e.places||{},n=e.storyScenes||[])},i=(e,t)=>{if(!e||!t)return null;let r=c[e];if(!r||!r.imageFolder||!r.emotions||!r.emotions[t])return null;try{return"/assets/characters/".concat(r.imageFolder,"/").concat(r.emotions[t])}catch(r){return console.error("Failed to generate URL for ".concat(e," with emotion ").concat(t,":"),r),null}},s=e=>{if(!e)return null;let t=a[e];if(!t||!t.image)return null;try{return"/assets/places/".concat(t.image)}catch(t){return console.error("Failed to generate URL for place ".concat(e,":"),t),null}},l=e=>{if(!e)return null;try{return"/assets/cutscenes/".concat(e)}catch(t){return console.error("Failed to generate URL for cutscene ".concat(e,":"),t),null}},u=e=>{let t=[];return e&&e.characters&&Array.isArray(e.characters)&&e.characters.forEach(e=>{if(e.id&&e.emotion){let r=i(e.id,e.emotion);r&&t.push(r)}}),t},h=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,c=[];if(!e)return c;if(e.place){let t=s(e.place);t&&c.push(t)}if(e.cutsceneImage){let t=l(e.cutsceneImage);t&&c.push(t)}if(e.characters&&Array.isArray(e.characters)&&e.characters.forEach(e=>{if(e.id&&e.emotion){let t=i(e.id,e.emotion);t&&c.push(t)}}),e.dialogues&&Array.isArray(e.dialogues)){let a=Math.min(e.dialogues.length,t+r);for(let r=t;r<a;r++){let t=u(e.dialogues[r]);c.push(...t)}}else if(e.dialogue){let t=u(e.dialogue);c.push(...t)}return"choice"===e.type&&e.choices&&Array.isArray(e.choices)&&e.choices.forEach(e=>{let t=(e=>{let t=[];if(!e||!e.reaction)return t;let r=e.reaction;return r.characters&&Array.isArray(r.characters)&&r.characters.forEach(e=>{if(e.id&&e.emotion){let r=i(e.id,e.emotion);r&&t.push(r)}}),t})(e);c.push(...t)}),c},d=e=>e&&n.find(t=>t.id===e)||null,f=e=>{if(!e)return null;if("choice"===e.type&&e.choices&&Array.isArray(e.choices)){let t=e.choices.map(e=>e.next).filter(e=>e);return t.length>0?t:null}return e.next||null},m=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{lookAheadDialogues:c=5,lookAheadScenes:a=2}=r,o=new Set,i=d(e);if(!i)return console.warn("[ImageCollector] Scene not found: ".concat(e)),[];h(i,t,c+1).forEach(e=>o.add(e)),i.checkAffection&&(console.log("[ImageCollector] checkAffection scene detected, preloading all ending images"),n.filter(e=>"ending"===e.type).forEach(e=>{if(e.place){let t=s(e.place);t&&o.add(t)}if(e.cutsceneImage){let t=l(e.cutsceneImage);t&&o.add(t)}}));let u=f(i);return u&&(Array.isArray(u)?u:[u]).forEach(e=>{let t=d(e);if(t&&(h(t).forEach(e=>o.add(e)),a>1)){let e=f(t);e&&(Array.isArray(e)?e:[e]).forEach(e=>{let t=d(e);t&&h(t).forEach(e=>o.add(e))})}}),Array.from(o)},g=e=>{let t=d(e);return t?h(t):[]},p=()=>{let e=[];try{e.push("/assets/title.png"),["story.svg","musicon.svg","musicoff.svg"].forEach(t=>{try{e.push("/assets/icon/".concat(t))}catch(e){console.warn("Failed to generate URL for icon ".concat(t,":"),e)}})}catch(e){console.error("Failed to collect title screen images:",e)}return e}},6892:(e,t,r)=>{r.d(t,{Ju:()=>o,SD:()=>i,Uj:()=>s,uk:()=>a});let c=[],a=e=>{e&&e.storyScenes&&(c=e.storyScenes)},n=e=>!!e&&c.some(t=>t.id===e),o=e=>{if(!e)return{isValid:!1,error:"씬 데이터가 없습니다."};if("ending"===e.type)return{isValid:!0};if("title"===e.type)return e.next&&n(e.next)?{isValid:!0}:{isValid:!1,error:"타이틀 화면의 다음 씬이 없습니다."};if("choice"===e.type){if(!e.choices||0===e.choices.length)return{isValid:!1,error:"선택지가 없습니다."};let t=e.choices.find(e=>!e.next||!n(e.next));return t?{isValid:!1,error:'선택지 "'.concat(t.text,'"의 다음 씬이 없습니다.')}:{isValid:!0}}return e.next||e.checkAffection?e.next&&!n(e.next)?{isValid:!1,error:'다음 씬 "'.concat(e.next,'"이(가) 존재하지 않습니다.')}:{isValid:!0}:{isValid:!1,error:"다음 씬이나 엔딩 분기가 없습니다."}},i=e=>{if(!e)return!1;let t=c.find(t=>t.id===e);return t&&"ending"===t.type},s=e=>!!e&&!!e.type&&!!e.title&&!!e.message},8132:(e,t,r)=>{r.d(t,{K8:()=>o,uS:()=>s,uk:()=>n});let c={},a={},n=e=>{e&&(c=e.endingConfig||{},a=e.characters||{})},o=e=>{let{thresholds:t,common:r,characterEndings:a,duo:n}=c,o=Object.entries(e),s=Math.max(...o.map(e=>{let[,t]=e;return t}));if(s<t.bad)return{type:"bad",character:null,title:r.bad.title,message:r.bad.message};let l=o.filter(e=>{let[,r]=e;return r>=t.best}),u=l.map(e=>{let[t]=e;return t});if(1===l.length){let[e]=u,t=null==a?void 0:a[e];if(null==t?void 0:t.best)return{type:"best",character:e,...t.best};if(null==r?void 0:r.best)return{type:"best",character:e,title:r.best.title||"".concat(i(e)," - Best 엔딩"),message:r.best.message||"".concat(i(e),"와 최고의 관계를 맺었다."),cutsceneImage:r.best.cutsceneImage}}if(l.length>=2&&n&&Array.isArray(n)){for(let e of[...n].sort((e,t)=>t.characters.length-e.characters.length))if(e.characters.every(e=>u.includes(e)))return{type:"duo",character:null,characters:e.characters,title:e.title,message:e.message,cutsceneImage:e.cutsceneImage};return{type:"duo",character:null,characters:u,title:"함께한 길",message:"모두와 함께 걸어간 소중한 시간이었다."}}let h=o.find(e=>{let[,t]=e;return t===s})[0],d=null==a?void 0:a[h];if(s>=t.good)if(null==d?void 0:d.good)return{type:"good",character:h,...d.good};else if(null==r?void 0:r.good)return{type:"good",character:h,title:r.good.title||"".concat(i(h)," - Good 엔딩"),message:r.good.message||"".concat(i(h),"와 좋은 관계를 맺었다."),cutsceneImage:r.good.cutsceneImage};else return{type:"good",character:h,title:"".concat(i(h)," - Good 엔딩"),message:"".concat(i(h),"와 좋은 관계를 맺었다.")};return(null==r?void 0:r.normal)?{type:"normal",character:null,title:r.normal.title,message:r.normal.message,cutsceneImage:r.normal.cutsceneImage}:{type:"normal",character:h,title:"".concat(i(h)," - Normal 엔딩"),message:"".concat(i(h),"와 친해졌다.")}},i=e=>{var t;return(null==(t=a[e])?void 0:t.name)||e},s=e=>{var t,r,a,n;if(!e)return null;let{common:o,characterEndings:s,duo:l}=c;if("bad_ending"===e)return{type:"bad",character:null,title:(null==o||null==(t=o.bad)?void 0:t.title)||"Bad 엔딩",message:(null==o||null==(r=o.bad)?void 0:r.message)||"모험이 좋지 않게 끝났다."};if("normal_ending"===e)return{type:"normal",character:null,title:(null==o||null==(a=o.normal)?void 0:a.title)||"Normal 엔딩",message:(null==o||null==(n=o.normal)?void 0:n.message)||"평범한 여정이었다."};if(e.startsWith("duo_ending_")){let t=e.replace("duo_ending_","").split("_");if(l&&Array.isArray(l)){let e=l.find(e=>e.characters.length===t.length&&e.characters.every(e=>t.includes(e)));if(e)return{type:"duo",character:null,characters:e.characters,title:e.title,message:e.message,cutsceneImage:e.cutsceneImage}}return{type:"duo",character:null,characters:t,title:"함께한 길",message:"모두와 함께 걸어간 소중한 시간이었다."}}let u=e.match(/^(best|good|normal)_ending_(.+)$/);if(u){let[,e,t]=u,r=null==s?void 0:s[t];if(null==r?void 0:r[e])return{type:e,character:t,...r[e]};let c=null==o?void 0:o[e];return c?{type:e,character:t,title:c.title||"".concat(i(t)," - ").concat(e," 엔딩"),message:c.message||"".concat(i(t),"와 좋은 관계를 맺었다."),cutsceneImage:c.cutsceneImage}:{type:e,character:t,title:"".concat(i(t)," - ").concat(e," 엔딩"),message:"".concat(i(t),"와 함께한 여정이었다.")}}return null}},8868:(e,t,r)=>{r.d(t,{C$:()=>c,FI:()=>d,IL:()=>u,Wm:()=>l});let c={ERROR:"error",WARNING:"warning"},a=["normal","choice","ending","title"],n=function(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c.ERROR;return{path:e,type:t,message:r,severity:a}},o=(e,t,r)=>void 0===e[t]||null===e[t]?n("".concat(r,".").concat(t),"missing_required","필수 필드 '".concat(t,"'가 누락되었습니다."),c.ERROR):null,i=(e,t,r,a)=>{let o=Array.isArray(e)?"array":typeof e;return o!==t?n(r,"type_mismatch","'".concat(a,"'의 타입이 잘못되었습니다. 예상: ").concat(t,", 실제: ").concat(o),c.ERROR):null},s=(e,t,r)=>"string"==typeof e&&""===e.trim()?n(t,"empty_value","'".concat(r,"'이 빈 문자열입니다."),c.WARNING):null,l=e=>{let t=[];return e&&"object"==typeof e?(t.push(...(e=>{let t=[],r="gameInfo";if(!e)return t.push(n(r,"missing_section","gameInfo 섹션이 누락되었습니다.")),t;if(["title","subtitle","me"].forEach(c=>{let a=o(e,c,r);a&&t.push(a)}),e.title){let c=i(e.title,"string","".concat(r,".title"),"title");c&&t.push(c)}if(e.title){let c=s(e.title,"".concat(r,".title"),"title");c&&t.push(c)}return t})(e.gameInfo)),t.push(...(e=>{let t=[],r="characters";return e&&"object"==typeof e?Object.entries(e).forEach(e=>{let[a,i]=e,s="".concat(r,".").concat(a);["id","name","color","imageFolder","emotions"].forEach(e=>{let r=o(i,e,s);r&&t.push(r)}),i.emotions&&("object"!=typeof i.emotions?t.push(n("".concat(s,".emotions"),"type_mismatch","emotions는 객체여야 합니다.",c.ERROR)):0===Object.keys(i.emotions).length&&t.push(n("".concat(s,".emotions"),"empty_object","최소 1개 이상의 emotion이 필요합니다.",c.WARNING))),void 0!==i.minAffection&&void 0!==i.maxAffection&&i.minAffection>i.maxAffection&&t.push(n("".concat(s,".minAffection"),"invalid_range","minAffection이 maxAffection보다 큽니다.",c.ERROR))}):t.push(n(r,"missing_section","characters 섹션이 누락되었거나 타입이 잘못되었습니다.")),t})(e.characters)),t.push(...(e=>{let t=[],r="places";return e&&"object"==typeof e?Object.entries(e).forEach(e=>{let[c,a]=e,n="".concat(r,".").concat(c);if(["id","name"].forEach(e=>{let r=o(a,e,n);r&&t.push(r)}),void 0!==a.image){let e=i(a.image,"string","".concat(n,".image"),"image");e&&t.push(e)}}):t.push(n(r,"missing_section","places 섹션이 누락되었거나 타입이 잘못되었습니다.")),t})(e.places)),t.push(...((e,t,r)=>{let l=[],u="storyScenes";return e&&Array.isArray(e)?0===e.length?l.push(n(u,"empty_array","storyScenes가 비어있습니다.")):(e.some(e=>"scene1"===e.id)||l.push(n(u,"missing_scene1","시작 scene (scene1)이 존재하지 않습니다.",c.ERROR)),e.forEach((e,u)=>{let h=((e,t,r)=>{let l=[],u="scenes.".concat(e.id);if(!e.id)return l.push(n(u,"missing_id","scene.id가 누락되었습니다.")),l;if(e.type){let t=((e,t,r,a)=>t.includes(e)?null:n(r,"invalid_enum","'".concat(a,"'의 값이 유효하지 않습니다. 허용된 값: ").concat(t.join(", ")),c.ERROR))(e.type,a,"".concat(u,".type"),"type");t&&l.push(t)}if(e.place&&r&&!r[e.place]&&l.push(n("".concat(u,".place"),"invalid_reference","존재하지 않는 place: ".concat(e.place),c.WARNING)),e.dialogues){let r=i(e.dialogues,"array","".concat(u,".dialogues"),"dialogues");r?l.push(r):(0===e.dialogues.length&&l.push(n("".concat(u,".dialogues"),"empty_array","dialogues 배열이 비어있습니다.",c.WARNING)),e.dialogues.forEach((e,r)=>{let a=((e,t,r,a)=>{let l=[],u="".concat(r,".dialogues[").concat(t,"]");if(!e||"object"!=typeof e)return l.push(n(u,"invalid_dialogue","dialogue가 유효하지 않습니다.")),l;if(void 0!==e.speaker&&"narrator"!==e.speaker&&"me"!==e.speaker&&"???"!==e.speaker){let t=i(e.speaker,"string","".concat(u,".speaker"),"speaker");t?l.push(t):a&&!a[e.speaker]&&l.push(n("".concat(u,".speaker"),"invalid_character_reference","존재하지 않는 캐릭터 참조: ".concat(e.speaker),c.ERROR))}let h=o(e,"text",u);if(h)l.push(h);else{let t=i(e.text,"string","".concat(u,".text"),"text");t&&l.push(t);let r=s(e.text,"".concat(u,".text"),"text");r&&l.push(r)}if(void 0!==e.characters){let t=i(e.characters,"array","".concat(u,".characters"),"characters");t?l.push(t):e.characters.forEach((e,t)=>{let r="".concat(u,".characters[").concat(t,"]");if(!e||"object"!=typeof e)return void l.push(n(r,"invalid_character","character가 유효하지 않습니다."));if(["id","emotion","position"].forEach(t=>{let c=o(e,t,r);c&&l.push(c)}),e.id&&a&&!a[e.id]&&l.push(n("".concat(r,".id"),"invalid_character_reference","존재하지 않는 캐릭터: ".concat(e.id),c.ERROR)),e.id&&e.emotion&&a&&a[e.id]){let t=a[e.id];t.emotions&&!t.emotions[e.emotion]&&l.push(n("".concat(r,".emotion"),"invalid_emotion_reference","캐릭터 ".concat(e.id,"에 존재하지 않는 emotion: ").concat(e.emotion),c.ERROR))}})}return l})(e,r,u,t);l.push(...a)}))}return e.characters&&Array.isArray(e.characters)&&e.characters.forEach((e,r)=>{let a="".concat(u,".characters[").concat(r,"]");if(e.id&&t&&!t[e.id]&&l.push(n("".concat(a,".id"),"invalid_character_reference","존재하지 않는 캐릭터: ".concat(e.id),c.ERROR)),e.id&&e.emotion&&t&&t[e.id]){let r=t[e.id];r.emotions&&!r.emotions[e.emotion]&&l.push(n("".concat(a,".emotion"),"invalid_emotion_reference","캐릭터 ".concat(e.id,"에 존재하지 않는 emotion: ").concat(e.emotion),c.ERROR))}}),"choice"===e.type&&(e.choices&&Array.isArray(e.choices)?0===e.choices.length?l.push(n("".concat(u,".choices"),"empty_choices","choices 배열이 비어있습니다.",c.ERROR)):e.choices.forEach((e,r)=>{let a="".concat(u,".choices[").concat(r,"]"),i=o(e,"text",a);i&&l.push(i),void 0===e.next&&l.push(n("".concat(a,".next"),"missing_required","필수 필드 'next'가 누락되었습니다.",c.ERROR)),e.reaction&&e.reaction.characters&&Array.isArray(e.reaction.characters)&&e.reaction.characters.forEach((e,r)=>{let o="".concat(a,".reaction.characters[").concat(r,"]");if(e.id&&t&&!t[e.id]&&l.push(n("".concat(o,".id"),"invalid_character_reference","존재하지 않는 캐릭터: ".concat(e.id),c.ERROR)),e.id&&e.emotion&&t&&t[e.id]){let r=t[e.id];r.emotions&&!r.emotions[e.emotion]&&l.push(n("".concat(o,".emotion"),"invalid_emotion_reference","캐릭터 ".concat(e.id,"에 존재하지 않는 emotion: ").concat(e.emotion),c.ERROR))}})}):l.push(n("".concat(u,".choices"),"missing_choices","choice scene에 choices 배열이 없습니다.",c.ERROR))),"ending"===e.type||"choice"===e.type||e.checkAffection||e.next||l.push(n("".concat(u,".next"),"missing_next","next scene이 지정되지 않았습니다. (ending/choice scene이 아닌 경우 필수)",c.WARNING)),l})(e,t,r);l.push(...h)})):l.push(n(u,"missing_section","storyScenes 섹션이 누락되었거나 배열이 아닙니다.")),l})(e.storyScenes,e.characters,e.places)),t.push(...((e,t)=>{let r=[],a="endingConfig";return e?(e.thresholds&&["bad","normal","good","best"].forEach(t=>{void 0===e.thresholds[t]&&r.push(n("".concat(a,".thresholds.").concat(t),"missing_threshold","threshold ".concat(t,"이 누락되었습니다."),c.WARNING))}),e.characterEndings&&t&&Object.keys(e.characterEndings).forEach(e=>{t[e]||r.push(n("".concat(a,".characterEndings.").concat(e),"invalid_character_reference","존재하지 않는 캐릭터: ".concat(e),c.ERROR))}),e.duo&&t&&Object.keys(e.duo).forEach(o=>{let i=e.duo[o];i.characters&&Array.isArray(i.characters)&&i.characters.forEach(e=>{t[e]||r.push(n("".concat(a,".duo.").concat(o,".characters"),"invalid_character_reference","존재하지 않는 캐릭터: ".concat(e),c.ERROR))})})):r.push(n(a,"missing_section","endingConfig 섹션이 누락되었습니다.",c.WARNING)),r})(e.endingConfig,e.characters))):t.push(n("root","invalid_data","storyData가 유효하지 않습니다.")),t},u=e=>{let t=e.filter(e=>e.severity===c.ERROR).length,r=e.filter(e=>e.severity===c.WARNING).length;return{total:e.length,errors:t,warnings:r,hasErrors:t>0,hasWarnings:r>0}},h=[],d=e=>{if(e.map(e=>e.path+e.type).join(",")===h.map(e=>e.path+e.type).join(","))return;if(h=e,0===e.length)return void console.log("[StoryData Validation] ✅ 검증 완료. 문제 없음.");let t=u(e);console.group("[StoryData Validation] ⚠️ ".concat(t.total,"개 문제 발견 (에러: ").concat(t.errors,", 경고: ").concat(t.warnings,")")),e.forEach(e=>{let t=e.severity===c.ERROR?"❌":"⚠️";console.log("".concat(t," [").concat(e.severity.toUpperCase(),"] ").concat(e.path,": ").concat(e.message))}),console.groupEnd()}},9051:(e,t,r)=>{r.d(t,{GameContextProvider:()=>f,x:()=>m});var c=r(5155),a=r(2115),n=r(4305),o=r(3550),i=r(4197),s=r(8132),l=r(6892),u=r(2418),h=r(8868);let d=(0,a.createContext)(null),f=e=>{let{children:t}=e,[r,f]=(0,a.useState)(!0),[m,g]=(0,a.useState)(!1),[p,y]=(0,a.useState)(null),[v,R]=(0,a.useState)(!0),[E,A]=(0,a.useState)(null),[_,b]=(0,a.useState)([]);(0,a.useEffect)(()=>{(async()=>{try{let e=Date.now(),t=await fetch("/storyData.json?v=".concat(e),{cache:"no-cache"});if(!t.ok)throw Error("Failed to load story data: ".concat(t.status));let r=await t.json();y(r);let c=(0,h.Wm)(r);b(c),(0,h.FI)(c),(0,n.uk)(r),(0,o.uk)(r),(0,i.u)(r),(0,s.uk)(r),(0,l.uk)(r),(0,u.u)(r),R(!1)}catch(e){console.error("[GameContext] 스토리 데이터 로드 실패:",e),A(e.message),R(!1)}})()},[]);let k=(0,a.useCallback)(()=>{f(e=>!e)},[]),x={isMuted:r,setIsMuted:f,toggleMute:k,hasInteracted:m,setHasInteracted:g,storyData:p,isLoading:v,loadError:E,validationErrors:_,gameInfo:null==p?void 0:p.gameInfo,characters:null==p?void 0:p.characters,places:null==p?void 0:p.places,storyScenes:null==p?void 0:p.storyScenes,endingConfig:null==p?void 0:p.endingConfig};return(0,c.jsx)(d.Provider,{value:x,children:t})},m=()=>{let e=(0,a.useContext)(d);if(!e)throw Error("useGameContext must be used within GameContextProvider");return e}}}]);